# GTA CTF Challenge Series - Complete Writeup

*This challenge took me for a looooong but fun ride and really put me in the shoes of a forensic investigator.*

## Overview

The GTA CTF challenge was a multi-part digital forensics investigation that involved analyzing a compromised Windows system image. What started as a seemingly straightforward file recovery task evolved into an extensive backdoor hunt that lasted over 6 hours of intensive investigation.

## Part 1: The Easy Start - File Exfiltration Flag

The first part of the GTA series was rather trivial, following standard digital forensics methodology:

### Initial Investigation Strategy
1. **Desktop Analysis**: New folders/files on the desktop are typically the first place to look
2. **Documents Folder**: The logical second location for user-created content
3. **PowerShell Script Analysis**: Located suspicious scripts that weren't a match for AI analyst tools

### Key Discovery
The PowerShell scripts pointed directly to a PDF file. However, it wasn't immediately evident that the PDF filename itself was the flag, which led to a detour:

- Initially tried extracting flag strings from the PDF content using `strings` command
- Attempted various forensic techniques on the PDF file itself
- **Breakthrough moment**: Realized "this is the file they were trying to exfil" - tried the filename as the flag and it worked!

**Flag Format**: The filename of the exfiltrated PDF (`Haaland_Geita.pdf`)

---

## Part 2: The Long Hunt - Backdoor Discovery

*This is where the real investigation began...*

### Initial Assumptions and False Starts

At this point, I hadn't fully inspected the `contosso.exe` file but knew about its existence. I initially thought this file was related to the backdoor task.

#### The Contosso.exe Analysis
- **Discovery**: Found two versions mentioned in emails, but only one `.exe` was present on the system
- **Action**: Unzipped the first version that was missing
- **Problem**: Windows Defender immediately quarantined it ðŸ˜‘
- **Analysis**: 
  - Compared MD5 hashes - they were different
  - Neither hash worked as the flag
  - Realized an exe file itself probably isn't a backdoor - need to understand how it *installs* one

#### Reverse Engineering Phase
- Started reversing `contosso.exe` to understand its functionality
- Discovered it was responsible for the PowerShell script presence
- Found references to the Windows Registry through `strings` analysis
- **Key Discovery**: Investigating system services revealed `cryptoss.dll`

#### The Cryptoss.dll Investigation
- Initially convinced this DLL was the backdoor
- Tried the `cryptoss.dll` MD5 hash as the flag - **failed**
- Spent significant time reverse engineering the DLL without success
- Asked AI assistant - confirmed it wasn't a standard Windows DLL
- **Frustration Point**: Finally googled it and found references, became very annoyed and set it aside

### Desperate Measures and Breakthrough

With no clear leads remaining:

1. **Downloads Folder Analysis**: Found several executables, tried all their MD5 hashes - none worked
2. **AI Assistant Deployment**: In desperation, gave a Claude agent access to the whole system with the instruction: *"There is a backdoor here, help me find it"*

#### The Agent's Search Strategy
The AI agent performed systematic searches:
- **PowerShell Files**: Immediately found the PDF from the first task (already solved)
- **Filename Search**: Used system-wide search for "KCSC"
- **Content Search**: **BREAKTHROUGH** - searched file content for "KCSC"

### The Discovery

**The agent found a file containing the flag!**

- Located in an obscure directory
- Initial assumption: Thought it was keylogger output
- **Content**: Found `KCSC{its_all_in` but the string was cut off
- The file also contained references to BitLocker and other system information

### Following the Trail

After extensive searching for the rest of the flag string in related files and directories:

#### The "Scheduled Tasks" Clue
- Noticed "Scheduled tasks" mentioned in the search terms
- **Realization**: This could be a clue to the backdoor mechanism!
- **Investigation**: Immediately checked Windows Scheduled Tasks

#### Suspicious Discovery
Found `avast.exe` in a log folder - highly suspicious location for antivirus software

#### The Crash Dump Analysis
The suspicious `avast.exe` led to a set of crash dumps:
- Spent considerable time analyzing crash dump files
- Attempted to extract encoded flag data from the garbled dump contents
- **Dead End**: This approach proved fruitless

#### Back to Reverse Engineering
Returned to analyzing `avast.exe` with renewed focus:
- After further inspection and a small detour looking for local web servers
- **Final Breakthrough**: Found reference to `keylog.txt`

### The Final Discovery

After approximately 6 hours of investigation:

- **Almost by chance**: Hit part of the text "ylog.txt" while focusing on something else
- This led to the discovery of the actual keylogger files
- The rest was quickly solved with AI assistance

---

## Technical Analysis: The Backdoor Mechanism

### Components Discovered

1. **Initial Vector**: `contosso.exe` - Responsible for system modification
2. **Persistence**: PowerShell scripts for maintaining access  
3. **Registry Modifications**: System service manipulation
4. **Keylogger Component**: `rotta.exe` (Rottas keylogger)
5. **Data Exfiltration**: Local logging with planned remote transmission
6. **Disguise Mechanism**: Malware masquerading as legitimate Avast antivirus

### The Keylogger Analysis

From the AI log analysis, we can see the detailed forensic examination:

#### Malware Characteristics
- **Filename**: `rotta.exe` (Rottas keylogger)
- **Location**: `C:\Temp\rotta.exe` 
- **Technology**: .NET Framework application (v4.0.30319)
- **Architecture**: 32-bit application on 64-bit system (WoW64)

#### Evasion Techniques
- **Disguise**: Presented itself as `avast.exe` in some contexts
- **Location Spoofing**: Stored in `C:\Users\BÃ¸rge Malter\AppData\Roaming\Avast Software\Avast\log\avast.exe`
- **Anti-Analysis**: Multiple crash instances suggesting anti-debugging measures

#### Data Exfiltration Methods
The hex dump analysis revealed:
- **Local Logging**: `keylog.txt` and `exfil_simulated.log`
- **Remote Exfiltration**: References to `pastebin.com` URLs
- **HTTP Communication**: POST requests to `127.0.0.1:8000` (local testing server)

### Final Flag Extraction

The keylogger captured the actual flag being typed:

**Raw Keystrokes**: `LShiftKeyLShiftKeyLShiftKeyLShiftKeyKCSLShiftKeyOemOpenBracketsITSALLINTHEKEYSLShiftKeyLShiftKeyLShiftKeyLShiftKeyLShiftKeyLShiftKeyLShiftKeyLShiftKeyOem6`

**Decoded**: 
- Multiple `LShiftKey` presses (noise/multiple shift activations)
- `KCS` + `LShiftKey` = `KCSC`
- `OemOpenBrackets` = `{`
- `ITSALLINTHEKEYS` = flag content
- `Oem6` = `}`

**Final Flag**: `KCSC{ITSALLINTHEKEYS}`

---

## Key Lessons Learned

### Forensic Investigation Methodology
1. **Systematic Approach**: Start with obvious locations but be prepared for deep dives
2. **Tool Utilization**: AI assistants can provide fresh perspectives on complex investigations  
3. **Persistence**: Some discoveries happen by accident after hours of focused work
4. **Multiple Attack Vectors**: Modern malware uses various techniques for persistence and evasion

### Technical Insights
1. **Registry Analysis**: Always check system services for unauthorized modifications
2. **Crash Dump Analysis**: While informative, can be a time-consuming rabbit hole
3. **Filename Significance**: Sometimes the answer is simpler than expected (PDF filename)
4. **Keylogger Detection**: Look for input method libraries (IMM32.DLL) and suspicious crash patterns

### Investigation Tools and Techniques
- **Hex Dump Analysis**: Critical for understanding binary file contents
- **String Analysis**: Useful for finding embedded URLs, commands, and references
- **AI-Assisted Search**: Powerful for systematic file and content searches
- **Reverse Engineering**: Essential but time-intensive for complex malware

---

## Conclusion

This CTF challenge excellently simulated a real-world incident response scenario, complete with:
- **False leads** that consumed significant investigation time
- **Multi-layered persistence mechanisms** requiring different analysis approaches  
- **Evasion techniques** that complicated detection and analysis
- **The satisfaction** of finally connecting all the pieces after hours of work

The investigation highlighted the importance of both systematic methodology and creative thinking in digital forensics. Sometimes the breakthrough comes from an unexpected angle - in this case, realizing that scheduled tasks could be a clue to backdoor persistence, leading to the discovery of the keylogger files.

*As noted in the AI log, the final conversation with the AI assistant was quite amusing and provided a fitting end to this extensive forensic adventure.*

---

## Appendix: AI Investigation Log

*The complete AI assistant interaction log is included below, showing the detailed technical analysis that led to the final flag discovery:*

```
[See AI log.txt for complete technical analysis and hex dump decoding process]
```

**Final Flags**:
- Part 1 (File Exfiltration): `Haaland_Geita.pdf`
- Part 2 (Backdoor Discovery): `KCSC{ITSALLINTHEKEYS}`
