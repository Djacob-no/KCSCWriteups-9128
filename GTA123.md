# GTA CTF: A looooong (but fun) ride

*This challenge took me for a looooong but fun ride and really put me in the shoes of a forensic investigator. It ended up being my favourite challenge(s) this CTF.*

## The story

The first part of the GTA series was rather trivial. A bunch of new folders on the desktop is about the first place I would look, the Documents folder after that. The PowerShell scripts were no match for an AI analyst, and they pointed straight to the PDF. However, it wasnâ€™t immediately evident that the PDF name in itself was the flag. So this took us for a little ride trying to uncover a typical flag string in the PDFâ€”using strings on it and such. Luckily a thought entered my head: this is the file they were trying to exfil, and the text asks for the file, so let me just try the filenameâ€”and it worked.

Then started the much, much, much longer task of trying to find the backdoor. At this point I had not inspected the `cryptosso.exe` file, but I knew about it. I thought that file was related to the second taskâ€”the backdoor. As I started looking into it, I noticed it had two versions from the emails. Only one .exe was there, so I unzipped the first version that was not there already. At this point Windows Defender quarantined it ðŸ˜‘ðŸ›¡ï¸. After dealing with that I noticed the MD5 hashes were different, and neither worked as the flag.

Then I thought that an .exe in itself is probably not a backdoor. I needed to find out how it installs a backdoor. So I started reversing it and trying to understand it. After a while I understood that this file was responsible for the PowerShell script being there. And with strings I saw references to the registry, i checked the `NTUSER.DAT` which gave me little except reinforced my beliefe that `cryptosso.exe` was a backdoor. Then started investigating the services on this machine I saw there was a `cryptoss.dll` ðŸ§©. I was sure this was related to the backdoor. I tried inputting the `cryptoss.dll` MD5 hash, but that didnâ€™t work eitherâ€¦ I was getting frustrated.

### The uphill climb

I spent some time trying to reverse the `cryptoss.dll` (not Googling it first), but I had no luck finding out anything about it. I asked the AI about it and it said it was not a standard Windows DLL, so I continued looking at it. But finally, when I Googled, I found references to it, got very annoyed, and laid it aside ðŸ˜¤. I had no clues left. I was desperate at this point. Many hours in. I didnt have access to a secure environment, but the `cryptosso.exe` that i had restored from quarantine was looking very tempting to run at this point âš ï¸ðŸ˜¬. Out of sheer desperation and without being in a secure environment i attached it to IDA and hit run. Added breakpoints and hit run again, and again. Finally i gave it up and settled with this file only being related to the first task of exfiltrating the PDF. 

### Light at the end of a tunnel

Later I went to the Downloads folder and saw a couple of executablesâ€”tried all their MD5 hashes. None of which worked. Now i was grasping at anyhting before giving up ðŸ« , I gave a Claude agent access to the whole system and said, â€œThere is a backdoor here, help me find it.â€ The agent searched for PowerShell files (among other things) and immediately found the PDF from the first task. Then I said: do a system-wide search for KCSC. It searched filenames, nothing. Then I said: search file content for KCSCâ€”and to my shock and surprise it found a file. I was ecstatic ðŸŽ‰.

It was in a weird folder, and I thought at first it was keylogger output. I had the AI write a script to extract the search terms from the noise, and I saw `KCSC{its_all_in`â€”but then it cut off and moved to BitLocker and other things. I looked at all the files in that directory and similar directories for the rest of the string. I tried everything around that file that I could think of.

### Back on track

When all hope was lost I thoughtâ€¦ what if the file is just a clue? Then I looked at the other search terms in the file and noticed â€œScheduled tasks.â€ Waitâ€”that could be a clue to a backdoor. I immediately went there and looked at the entries, found an `avast.exe` in a log folder, which was suspicious ðŸš©.

That file led me pretty quickly to a set of crash dumps, which I started spending a lot of time on. I tried extracting a lot of garbled gibberish from the crash dumps, thinking it was an encoded flag. After giving up on that, I went back to the `avast.exe` reversing, and upon further inspectionâ€”and also a small detour looking for a local webserverâ€”I finally, after about six hours of investigating this disk, found the final clue: a reference to a `keylog.txt`. However, as you can see in the log, it was almost a fluke that I hit part of the text `ylog.txt` as I was focusing on something else.

The rest was quickly solved with the help of the agent, and I thought the last part of the AI log was quite funnyâ€”so Iâ€™m including it below.

---

## Appendix: AI investigation log

The AI interaction log from the final moments is included here, showing how the trail unfolded and where the final clues appeared:

```plaintext
Djacob-no: in the KEYFINDINGS folder i have gathered some crash logs that are from a keylogger software called rottas I have an infected computers image mounted to my D: drive. i want you to analyse the logs in key findings and see what you can gather. 

GitHub Copilot: I'll help you analyze the keylogger crash logs from the KEYFINDINGS folder. Let me start by exploring the contents of that folder to understand what we're working with. 

Read [](file:///d%3A/Users/B%C3%B8rge%20Malter/Documents/KEYFINDINGS)

Interesting! I can see there are crash logs for both Avast (antivirus) and the "rotta.exe" keylogger. Let me examine the rotta.exe crash logs first since those are directly related to the 

Djacob-no: D:\Users\BÃ¸rge Malter\Documents\KEYFINDINGS

GitHub Copilot: I can see there are several crash dump folders in the KEYFINDINGS directory, including some specifically for "rotta.exe" which appears to be the keylogger you mentioned. Let me examine the contents of these folders to analyze what information we can gather. 

Read [](file:///d%3A/Users/B%C3%B8rge%20Malter/Documents/KEYFINDINGS/AppCrash_rotta.exe_ae3fdbfb66c71483b28f9603fffb3d2ebd9d3b_632c267c_53b7e9e9-e94a-4da0-985b-fee5db474496)

Read [](file:///d%3A/Users/B%C3%B8rge%20Malter/Documents/KEYFINDINGS/AppCrash_rotta.exe_ae3fdbfb66c71483b28f9603fffb3d2ebd9d3b_632c267c_920443e4-ba31-4cfa-b01c-91450e9212a2)

Now let me read the Windows Error Reporting (WER) files from both rotta.exe crashes to analyze what information they contain: 

Read [](file:///d%3A/Users/B%C3%B8rge%20Malter/Documents/KEYFINDINGS/AppCrash_rotta.exe_ae3fdbfb66c71483b28f9603fffb3d2ebd9d3b_632c267c_53b7e9e9-e94a-4da0-985b-fee5db474496/Report.wer#1-1), lines 1 to 50

Read [](file:///d%3A/Users/B%C3%B8rge%20Malter/Documents/KEYFINDINGS/AppCrash_rotta.exe_ae3fdbfb66c71483b28f9603fffb3d2ebd9d3b_632c267c_53b7e9e9-e94a-4da0-985b-fee5db474496/Report.wer#51-51), lines 51 to 100

Now let me read the second rotta.exe crash report: 

Read [](file:///d%3A/Users/B%C3%B8rge%20Malter/Documents/KEYFINDINGS/AppCrash_rotta.exe_ae3fdbfb66c71483b28f9603fffb3d2ebd9d3b_632c267c_920443e4-ba31-4cfa-b01c-91450e9212a2/Report.wer#1-1), lines 1 to 100

Let me also check one of the Avast crash reports to see if there's any connection or additional information: 

Read [](file:///d%3A/Users/B%C3%B8rge%20Malter/Documents/KEYFINDINGS/AppCrash_avast.exe_1b8773713ec61ca7751d645be7f653aa0d65dab_9042e8be_8b6230ca-ac0d-4060-bb24-cfced8ffaf4e/Report.wer#1-1), lines 1 to 50

Now let me check if there are any other files in the user directory that might contain keylogger data or related information: 

Read [](file:///d%3A/Users/B%C3%B8rge%20Malter/extract_keystrokes.py#1-1), lines 1 to 50

Read [](file:///d%3A/Users/B%C3%B8rge%20Malter/extract_flag.py#1-1), lines 1 to 50

Read [](file:///d%3A/Users/B%C3%B8rge%20Malter/reconstruct_keystrokes.py#1-1), lines 1 to 50

Now let me check if there are any actual keylogger data files in the temp_extract folder: 

Read [](file:///d%3A/Users/B%C3%B8rge%20Malter/temp_extract)

Based on my analysis of the crash logs and forensic files, here's what I can gather about the "Rottas" keylogger infection:

## Analysis of Rottas Keylogger Crash Logs

### Key Findings:

**1. Malware Identification:**
- **Filename:** `rotta.exe` (appears to be "Rottas" keylogger)
- **Location:** `C:\Temp\rotta.exe`
- **Version:** 1.0.0.0
- **Timestamp:** cb634244 (hexadecimal)
- **File Type:** .NET Framework application (uses .NET 4.0.30319)

**2. Crash Analysis:**
- **Exception Code:** `c0000005` (Access Violation - typical of memory corruption or anti-debugging)
- **Fault Module:** `StackHash_2beb` (indicates corrupted stack or anti-analysis measure)
- **Crash Location:** `ntdll.dll` at offset `PCH_0D_FROM_ntdll+0x000795EC`
- **Multiple Crashes:** Two separate crash instances within short timeframe

**3. System Information:**
- **OS:** Windows 11 (Build 26100.6584)
- **Architecture:** 32-bit application on 64-bit system (WoW64)
- **Locale:** English US (1033)

**4. Interesting Anomaly - Avast Connection:**
- One Avast crash report shows `OriginalFilename=rottas.exe` but `NsAppName=avast.exe`
- This suggests the malware may have been disguising itself as Avast antivirus
- Located in: `C:\Users\BÃ¸rge Malter\AppData\Roaming\Avast Software\Avast\log\avast.exe`

**5. Technical Characteristics:**
- Uses .NET Framework (managed code)
- Loaded typical Windows system libraries for UI interaction (USER32.dll, GDI32.dll)
- Uses IMM32.DLL (Input Method Manager - commonly used by keyloggers)
- Multiple crashes suggest either:
  - Detection evasion mechanisms failing
  - Anti-debugging protection triggering
  - Instability in the malware code

### Recommendations:

1. **Further Investigation Needed:**
   - Search for actual keystroke logs (likely encrypted/hidden)
   - Check registry entries for persistence mechanisms
   - Look for network connections/exfiltration attempts

2. **Your Analysis Scripts:**
   - Your extract_keystrokes.py and related scripts suggest you're analyzing Edge WebView logs
   - This indicates the keylogger may have captured browser-based typing
   - The CTF flag extraction suggests this might be from a cybersecurity exercise

The crashes indicate the keylogger was unstable, possibly due to security software interference or built-in anti-analysis measures. The disguise as Avast is particularly concerning as it shows sophisticated evasion techniques.

Would you like me to help analyze any specific log files or assist with running your keystroke extraction scripts on potential data files?

Djacob-no: 0403E10  79 00 6C 00 6F 00 67 00  2E 00 74 00 78 00 74 00  y.l.o.g...t.x.t.
0403E20  00 27 65 00 78 00 66 00  69 00 6C 00 5F 00 73 00  .'e.x.f.i.l._.s.
0403E30  69 00 6D 00 75 00 6C 00  61 00 74 00 65 00 64 00  i.m.u.l.a.t.e.d.
0403E40  2E 00 6C 00 6F 00 67 00  00 80 C7 5B 00 7B 00 30  ..l.o.g......{.0
0403E50  00 3A 00 4F 00 7D 00 5D  00 20 00 50 00 4F 00 53  .:.O.}.]. .P.O.S
0403E60  00 54 00 20 00 68 00 74  00 74 00 70 00 73 00 3A  .T. .h.t.t.p.s.:
0403E70  00 2F 00 2F 00 70 00 61  00 73 00 74 00 65 00 62  ././.p.a.s.t.e.b
0403E80  00 69 00 6E 00 2E 00 63  00 6F 00 6D 00 2F 00 66  .i.n...c.o.m./.f
0403E90  00 6D 00 73 00 61 00 6F  00 73 00 6A 00 6E 00 63  .m.s.a.o.s.j.n.c
0403EA0  00 6E 00 69 00 6F 00 73  00 61 00 6E 00 6F 00 73  .n.i.o.s.a.n.o.s
0403EB0  00 66 00 6D 00 6E 00 6F  00 70 00 73 00 61 00 66  .f.m.n.o.p.s.a.f
0403EC0  00 6D 00 6E 00 6F 00 73  00 61 00 20 00 2D 00 20  .m.n.o.s.a. .-. 
0403ED0  00 70 00 61 00 79 00 6C  00 6F 00 61 00 64 00 5F  .p.a.y.l.o.a.d._
0403EE0  00 73 00 69 00 7A 00 65  00 3D 00 7B 00 31 00 7D  .s.i.z.e.=.{.1.}
0403EF0  00 20 00 2D 00 20 00 73  00 74 00 61 00 74 00 75  . .-. .s.t.a.t.u
0403F00  00 73 00 3D 00 32 00 30  00 30 00 20 00 4F 00 4B  .s.=.2.0.0. .O.K
0403F10  00 01 4F 5B 00 45 00 52  00 52 00 4F 00 52 00 20  ..O[.E.R.R.O.R. 
0403F20  00 7B 00 30 00 3A 00 4F  00 7D 00 5D 00 20 00 45  .{.0.:.O.}.]. .E
0403F30  00 78 00 66 00 69 00 6C  00 20 00 74 00 61 00 73  .x.f.i.l. .t.a.s
0403F40  00 6B 00 20 00 66 00 61  00 69 00 6C 00 65 00 64  .k. .f.a.i.l.e.d
0403F50  00 3A 00 20 00 7B 00 31  00 7D 00 7B 00 32 00 7D  .:. .{.1.}.{.2.}
0403F60  00 00 63 5B 00 20 00 53  00 54 00 41 00 52 00 54  ..c[. .S.T.A.R.T
0403F70  00 45 00 44 00 20 00 7B  00 30 00 3A 00 4F 00 7D  .E.D. .{.0.:.O.}
0403F80  00 5D 00 20 00 49 00 6E  00 69 00 74 00 69 00 61  .]. .I.n.i.t.i.a
0403F90  00 6C 00 69 00 7A 00 69  00 6E 00 67 00 20 00 6B  .l.i.z.i.n.g. .k
0403FA0  00 65 00 79 00 6C 00 6F  00 67 00 67 00 65 00 72  .e.y.l.o.g.g.e.r
0403FB0  00 20 00 6F 00 75 00 74  00 70 00 75 00 74 00 7B  . .o.u.t.p.u.t.{
0403FC0  00 31 00 7D 00 00 55 5B  00 20 00 53 00 54 00 41  .1.}..U[. .S.T.A
0403FD0  00 52 00 54 00 45 00 44  00 20 00 7B 00 30 00 3A  .R.T.E.D. .{.0.:
0403FE0  00 4F 00 7D 00 5D 00 20  00 49 00 6E 00 69 00 74  .O.}.]. .I.n.i.t
0403FF0  00 69 00 61 00 6C 00 69  00 7A 00 69 00 6E 00 67  .i.a.l.i.z.i.n.g
0404000  00 20 00 65 00 78 00 66  00 69 00 6C 00 20 00 6C  . .e.x.f.i.l. .l
0404010  00 6F 00 67 00 7B 00 31  00 7D 00 00 15 74 00 65  .o.g.{.1.}...t.e
0404020  00 78 00 74 00 2F 00 70  00 6C 00 61 00 69 00 6E  .x.t./.p.l.a.i.n
0404030  00 00 67 68 00 74 00 74  00 70 00 73 00 3A 00 2F  ..gh.t.t.p.s.:./
0404040  00 2F 00 70 00 61 00 73  00 74 00 65 00 62 00 69  ./.p.a.s.t.e.b.i
0404050  00 6E 00 2E 00 63 00 6F  00 6D 00 2F 00 66 00 6D  .n...c.o.m./.f.m
0404060  00 73 00 61 00 6F 00 73  00 6A 00 6E 00 63 00 6E  .s.a.o.s.j.n.c.n
0404070  00 69 00 6F 00 73 00 61  00 6E 00 6F 00 73 00 66  .i.o.s.a.n.o.s.f
0404080  00 6D 00 6E 00 6F 00 70  00 73 00 61 00 66 00 6D  .m.n.o.p.s.a.f.m
0404090  00 6E 00 6F 00 73 00 61  00 00 59 5B 00 7B 00 30  .n.o.s.a..Y[.{.0
04040A0  00 3A 00 4F 00 7D 00 5D  00 20 00 4C 00 4F 00 43  .:.O.}.]. .L.O.C
04040B0  00 41 00 4C 00 5F 00 50  00 4F 00 53 00 54 00 20  .A.L._.P.O.S.T. 
04040C0  00 31 00 32 00 37 00 2E  00 30 00 2E 00 30 00 2E  .1.2.7...0...0..
04040D0  00 31 00 3A 00 38 00 30  00 30 00 30 00 20 00 73  .1.:.8.0.0.0. .s
04040E0  00 74 00 61 00 74 00 75  00 73 00 3D 00 7B 00 31  .t.a.t.u.s.=.{.1
04040F0  00 7D 00 00 43 5B 00 45  00 52 00 52 00 4F 00 52  .}..C[.E.R.R.O.R
0404100  00 20 00 7B 00 30 00 3A  00 4F 00 7D 00 5D 00 20  . .{.0.:.O.}.]. 
0404110  00 50 00 4F 00 53 00 54  00 20 00 66 00 61 00 69  .P.O.S.T. .f.a.i
0404120  00 6C 00 65 00 64 00 3A  00 20 00 7B 00 31 00 7D  .l.e.d.:. .{.1.}
0404130  00 7B 00 32 00 7D 00 00  DA 99 F8 29 2E 42 72 44  .{.2.}..Ú™ .).BrD
0404140  A4 2B 48 55 92 D0 DC 24  00 04 20 01 01 08 03 20  .+HU...$.. .... 
0404150  00 01 05 20 01 01 11 11  04 20 01 01 0E 04 20 01  ... ..... .... .
0404160  01 02 05 20 01 01 12 4D  06 20 01 01 12 80 89 04  ... ...M. ......
0404170  07 01 11 14 05 00 00 11  80 99 07 30 01 01 01 10  ...........0....
0404180  1E 00 04 0A 01 11 14 04  20 00 12 55 05 07 02 0E  ........ ..U....

GitHub Copilot: Excellent! You've provided a hex dump that contains very valuable information about the Rottas keylogger's operation. Let me analyze this data and extract the key intelligence. 

Created [](file:///d%3A/Users/B%C3%B8rge%20Malter/analyze_rottas_hexdump.py)

Ran terminal command: cd "d:\Users\BÃ¸rge Malter" && python analyze_rottas_hexdump.py

Ran terminal command: cd "d:\Users\BÃ¸rge Malter"; python analyze_rottas_hexdump.py

The decoding didn't work perfectly due to UTF-16 encoding issues. Let me create a more targeted analysis to manually decode the hex data: 

Created [](file:///d%3A/Users/B%C3%B8rge%20Malter/rottas_manual_analysis.py)

Ran terminal command: python "d:\Users\BÃ¸rge Malter\rottas_manual_analysis.py"

Perfect! Now let me search for those specific log files on the infected system: 

Searched for files matching `**/*ylog.txt`, no matches

Searched for files matching `**/*exfil*.log`, no matches

Searched text for `ylog|exfil|pastebin`, 20 results

Excellent! I found a very suspicious PowerShell script. Let me examine it: 

Read [](file:///d%3A/Users/B%C3%B8rge%20Malter/AppData/Roaming/Maltis/mfsaofmsaomfosa.ps1)

Now let me check if this referenced PDF file exists: 

Searched for files matching `**/Haaland_Geita.pdf`, 2 matches

Ran terminal command: Get-ItemProperty "d:\Users\BÃ¸rge Malter\Desktop\Haaland_Geita.pdf"

Made changes.

Djacob-no: wtf go look for ylog.txt instead

GitHub Copilot: You're absolutely right! Let me search for the `ylog.txt` file that was referenced in the hex dump. This is likely the actual keylogger output file. 

Searched for files matching `**/ylog.txt`, no matches

Searched text for `ylog\.txt`, 4 results

Let me search more broadly for any `.txt` or `.log` files that might contain the keylogger data: 

Ran terminal command: Get-ChildItem -Path "d:\" -Recurse -Include "ylog.txt","exfil_simulated.log" -ErrorAction SilentlyContinue | Select-Object FullName,Length,LastWriteTime

Let me try a different approach - search for any `.txt` files that might be the keylogger output: 

Ran terminal command: Get-ChildItem -Path "d:\Users\BÃ¸rge Malter\" -Recurse -Filter "*.txt" -ErrorAction SilentlyContinue | Select-Object FullName,Length,LastWriteTime

Let me also search for any log files: 

Ran terminal command: Get-ChildItem -Path "d:\Users\BÃ¸rge Malter\" -Recurse -Filter "*.log" -ErrorAction SilentlyContinue | Select-Object FullName,Length,LastWriteTime

Let me check the Temp directory specifically and also search in the AppData folders where malware often stores data: 

Ran terminal command: Get-ChildItem -Path "C:\Temp","d:\Users\BÃ¸rge Malter\AppData" -Recurse -Include "ylog.txt","*log*.txt","exfil*" -ErrorAction SilentlyContinue | Select-Object FullName,Length,LastWriteTime

The files aren't showing up in standard locations. Let me try searching the entire drive more comprehensively, including hidden files: 

Ran terminal command: Get-ChildItem -Path "d:\" -Recurse -Force -Include "*ylog*","*exfil*" -ErrorAction SilentlyContinue | Select-Object FullName,Length,LastWriteTime

Perfect! I found the keylogger files! Let me examine them: Let me use the terminal to read these files: 

Ran terminal command: Get-Content "D:\ProgramData\keylog.txt"

Ran terminal command: Get-Content "D:\ProgramData\exfil_simulated.log"

Excellent! I found the actual keylogger files. Let me also check if there are any other related files in that ProgramData directory: 

Ran terminal command: Get-ChildItem -Path "D:\ProgramData\" -Include "*log*","*key*","*rotta*","*.txt" -Force | Select-Object Name,Length,LastWriteTime

Ran terminal command: Get-ChildItem -Path "D:\ProgramData\" -Force | Where-Object {$_.Name -match "(log|key|rotta|txt)" -or $_.LastWriteTime -gt (Get-Date).AddDays(-60)} | Select-Object Name,Length,LastWriteTime

Perfect! Now let me create a comprehensive analysis script to decode the keylogger data properly: 

Created [](file:///d%3A/Users/B%C3%B8rge%20Malter/analyze_keylogger_data.py)

Ran terminal command: python "d:\Users\BÃ¸rge Malter\analyze_keylogger_data.py"

Excellent! Now I can see the full picture. Let me manually decode the key sequence more carefully: 

Ran terminal command: python -c "
sequence = 'LShiftKeyLShiftKeyLShiftKeyLShiftKeyKCSLShiftKeyOemOpenBracketsITSALLINTHEKEYSLShiftKeyLShiftKeyLShiftKeyLShiftKeyLShiftKeyLShiftKeyLShiftKeyLShiftKeyOem6'
print('Raw sequence:', sequence)
print()
print('Breaking it down:')
print('- Multiple LShiftKey presses (probably just noise/multiple shift presses)')
print('- KCS (start of flag)')
print('- LShiftKey (probably C -> uppercase)')
print('- OemOpenBrackets (this is the { character)')
print('- ITSALLINTHEKEYS (the flag content)')
print('- Multiple LShiftKey presses (more noise)')
print('- Oem6 (this is the } character)')
print()
print('Reconstructed flag: KCSC{ITSALLINTHEKEYS}')
"

Made changes.
```

---

